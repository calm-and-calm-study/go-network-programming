# 유닉스 도메인 소켓

## 유닉스 도메인 소켓이란?

- 파일 시스템을 이용하여 패킷의 목적지 주소를 결정하는 통신방법
- 동일한 노드 내에 동작하는 서비스 간에 IPC (Inter-Process-Communication) 프로세스 간 통신, 이라는 절차를 통해 데이터를 주고 받음
- 유닉스 도메인 소켓은 소켓 주소 정의 원칙을 파일 시스템에 적용하는 것
- 유닉스 도메인 소켓에는 파일 시스템 내에 연관된 파일이 존재하며, 그 파일은 네트워크 소켓의 IP 주소와 포트번호와 대응함
- 해당 파일에 네트워크 연결을 맺고 데이터를 읽고 씀으로써 해당 소켓에서 수신 대기 중인 서비스와 통신할 수 있음

<br />

### 유닉스 도메인 소켓의 주의할 점

- 유닉스 도메인 소켓은 소켓을 사용하는 노드 내의 로켈에서만 적용되기 때문에 네트워크 소켓을 사용하는 것처럼 다른 노드 간 통신 시에는 사용할 수 없음
- 통신을 유지하기 위해서는 먼저 네트워크 소켓 작업이 이루어져야 함

<br />

## 유닉스 도메인 소켓 타입 이해

- 유닉스는 TCP 처럼 동작하는 스트리밍 소켓 (streaming socket), UDP 처럼 동작하는 데이터그램 소켓(datagram socket), 마지막으로 두 요소를 조합한 시퀀스 패킷 소켓(sequence packet socket)이 있음
- go 에서는 이 소켓들을 각각 unix, unixgram, unixpacket 으로 부름

<br />

### 스트리밍 소캣 - unix

- 스트리밍 유닉스 모데인 소켓은 TCP 가 갖는 메시지 확인, 체크섬, 혼잡 제어 등의 오버헤드 없이도 TCP 처럼 동작

<br />

### 데이터그램 소켓 - unixgram

- unixgram 리스너와 통신할 경우 통신이 종료될 때 소켓 파일을 제거해야함

<br />

### 시퀀스 패킷 소켓 - unixpacket

- 세션을 지향하는 연결과 TCP 의 신뢰성, 그리고 각 메시지를 구분하여 관리하는 UDP 의 데이터그램의 특성을 모두 조합한 하이브리드 타입
- 그러나 시퀀스 패킷 소켓은 각 데이터그램이 요청하지 않은 데이터는 모두 버려버림
- 3개의 유닉스 도메인 소켓 타입 중 unixpacket 타입이 가장 이식성이 낮음

<br />

## 클라이언트와 인증하는 서비스 작성

- 리눅스 시스템에서 유닉스 도메인 소켓은 피어의 윤영체제로부터 인증 정보를 수신하여 소켓의 반대쪽 피어의 프로세스에 대한 정보를 알 수 있다.
- 이 정보를 통하여 유닉스 도메인 소켓의 반대쪽에 있는 피어의 접근을 허가하거나 거부할 수 있다.
- 특정한 사용자 또는 /etc/group 과 같이 파일 내의 특정한 그룹의 사용자로부터만 서비스로의 연결을 허용할 수 있다.


<br />

### 정리

- 유닉스 도메인 소켓이란 동일한 노드 내의 프로세스들이 파일 기반으로 통신하는 방법
- 로컬 데이터베이스 서버와 클라이언트와 같은 두 개 이상의 프로세스들이 유닉스 도메인 소켓을 통해 데이터를 주고 받는 것
- 유닉스 도메인 소켓은 주소 지정을 위해 파일시스템에 의존하므로 파일시스템의 소유권과 퍼미션을 이용하여 프로세스의 접근 제어를 할 수 있음
- go 에서는 이러한 유닉스 도메인 소켓 지원을 위해 unix, unixgram, unixpacket 을 지원하고 있음
- 피어의 인증정보, 그 정보를 이용하여 피어의 클라이언트 정보를 요청할 수 있음

